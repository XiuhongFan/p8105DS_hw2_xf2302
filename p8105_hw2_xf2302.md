p8105_hw2_xf2302
================
2025-09-30

# Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

# Clean pols-month.csv dataset

``` r
pols <- 
  read_csv("data/pols-month.csv") |> 
  separate(mon, into = c("year", "month", "day"), sep = "-") |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |> 
  select(-day, -prez_gop, -prez_dem)
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

# 2. Clean snp.csv dataset

``` r
snp <- 
  read_csv("data/snp.csv") |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    month = as.integer(month),
    year = as.integer(year),
    year = if_else(year < 100,            
                   if_else(year >= 50, 1900 + year, 2000 + year),
                   year),
    month = month.name[month]
  ) |> 
  select(year, month, close) |> 
  arrange(year, month)
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

# 3. Clean unemployment.csv

``` r
unemployment <- 
  read_csv("data/unemployment.csv") |> 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |> 
  mutate(
    year = as.integer(Year),
    month = month.name[match(month, month.abb)]
  ) |> 
  select(year, month, unemployment)
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

# 4. Merge datasets and inspect merged dataset

``` r
merged_data <- 
  pols |> 
  left_join(snp, by = c("year", "month")) |> 
  left_join(unemployment, by = c("year", "month"))
dim(merged_data)        
```

    ## [1] 822  11

``` r
range(merged_data$year) 
```

    ## [1] 1947 2015

``` r
head(merged_data)       
```

    ## # A tibble: 6 × 11
    ##    year month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##   <dbl> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ## 1  1947 January       23      51     253      23      45     198 dem          NA
    ## 2  1947 February      23      51     253      23      45     198 dem          NA
    ## 3  1947 March         23      51     253      23      45     198 dem          NA
    ## 4  1947 April         23      51     253      23      45     198 dem          NA
    ## 5  1947 May           23      51     253      23      45     198 dem          NA
    ## 6  1947 June          23      51     253      23      45     198 dem          NA
    ## # ℹ 1 more variable: unemployment <dbl>

The **FiveThirtyEight datasets** combine information on U.S. politics,
the stock market, and unemployment. The `pols-month.csv` dataset
contains monthly counts of national politicians (governors, senators,
and representatives) by political party, from 1947 to 2015.

The `snp.csv` dataset records monthly closing values of the S&P 500
index, ranging from 1950 to 2015. The `unemployment.csv` dataset
provides national unemployment rates, reported monthly from 1948 to
2015.

After cleaning and merging these datasets by year and month, the
resulting dataset has **822 rows** and **11 variables**, covering the
period **1947–2015**. Key variables include the counts of politicians by
party, the sitting president’s party, monthly unemployment rates, and
the S&P 500 closing values. Note that missing values occur where data
are not available (e.g., stock market values before 1950, unemployment
data in 1947).

# Problem 2

``` r
library(readxl)
library(dplyr)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'

    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

# Define a Cleaning Function

``` r
clean_trash <- function(sheet_name, wheel_name) {
  df <- read_excel(
    "data/202509 Trash Wheel Collection Data.xlsx",
    sheet = sheet_name,
    skip = 1
  ) |>
    clean_names() |> 
    filter(!is.na(dumpster)) |>          
    select(-starts_with("...")) |> 
    mutate(
      year = as.integer(year)   
    )
  
  if ("sports_balls" %in% colnames(df)) {
    df <- df |>
      mutate(sports_balls = as.integer(round(sports_balls, 0)))
  } else {
    df <- df |>
      mutate(sports_balls = NA_integer_)
  }
  df |>
    mutate(wheel = wheel_name)
}
```

# Clean Each Trash Wheel Dataset and combine Datasets

``` r
mr_trash   <- clean_trash("Mr. Trash Wheel", "Mr. Trash Wheel")
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

``` r
prof_trash <- clean_trash("Professor Trash Wheel", "Professor Trash Wheel")
gwynnda    <- clean_trash("Gwynns Falls Trash Wheel", "Gwynnda")
all_trash <- bind_rows(mr_trash, prof_trash, gwynnda)
```

# Compute Results

``` r
n_obs <- nrow(all_trash)
prof_total_weight <- sum(prof_trash$weight_tons, na.rm = TRUE)
gwynnda_cig_2022_06 <- gwynnda |>
  filter(year == 2022, month == "June") |>
  summarise(total_cig = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total_cig)
n_obs
```

    ## [1] 1188

``` r
prof_total_weight
```

    ## [1] 282.26

``` r
gwynnda_cig_2022_06
```

    ## [1] 18120

The combined Trash Wheel dataset contains 1188 observations.  
Professor Trash Wheel collected a total of 282.26 tons of trash.  
In June 2022, Gwynnda collected 18,120 cigarette butts. Key variables
include dumpster ID, collection date, total weight (in tons), counts of
plastic bottles, polystyrene, cigarette butts, and sports balls.

# Problem 3

library(readr) library(dplyr) library(tidyr) library(janitor)

# Load and clean Zip Codes and ZORI data

``` r
zips <- read_csv("data/Zip Codes.csv") %>% 
  clean_names()
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zori <- read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>% 
  clean_names()
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

# Tidy ZORI data

``` r
zori_tidy <- zori %>% 
  pivot_longer(
    cols = starts_with("x"),       
    names_to = "month",
    values_to = "rent_index"
  ) %>% 
  mutate(
    month = gsub("^x", "", month),                 
    month = as.Date(month, format = "%Y_%m_%d")    
  )
```

# Deduplicate ZIPs

``` r
zips_unique <- zips %>% distinct(zip_code, .keep_all = TRUE)
```

# Join ZORI + ZIP

``` r
zori_final <- zori_tidy %>%
  left_join(zips_unique, by = c("region_name" = "zip_code")) %>%
  arrange(region_name, month)
```

# Compute stats

``` r
n_obs <- nrow(zori_final)                                 
n_zip <- n_distinct(zori_final$region_name)               
n_neighborhood <- n_distinct(zori_final$neighborhood)     
```

# Find missing ZIPs

``` r
missing_zips <- setdiff(zips_unique$zip_code, zori$region_name)
```

# Compare 2020 vs 2021

``` r
zori_compare <- zori_final %>%
  filter(month %in% as.Date(c("2020-01-31", "2021-01-31"))) %>%
  select(region_name, county, neighborhood, month, rent_index) %>%  
  pivot_wider(
    names_from = month,
    values_from = rent_index,
    names_prefix = "rent_"
  ) %>%
  mutate(drop = `rent_2021-01-31` - `rent_2020-01-31`) %>%  
  arrange(drop) %>%
  slice_head(n = 10)
```

# Output results

``` r
n_obs
```

    ## [1] 17284

``` r
n_zip
```

    ## [1] 149

``` r
n_neighborhood
```

    ## [1] 43

``` r
missing_zips
```

    ##   [1] 10464 10474 10475 10499 10550 10704 10705 10803 11202 11224 11239 11241
    ##  [13] 11242 11243 11245 11247 11251 11252 11256 10008 10020 10041 10043 10045
    ##  [25] 10047 10048 10055 10072 10080 10081 10082 10087 10101 10102 10103 10104
    ##  [37] 10105 10106 10107 10108 10109 10110 10111 10112 10113 10114 10115 10116
    ##  [49] 10117 10118 10119 10120 10121 10122 10123 10124 10125 10126 10129 10130
    ##  [61] 10131 10132 10133 10138 10149 10150 10151 10152 10153 10154 10155 10156
    ##  [73] 10157 10158 10159 10160 10161 10163 10164 10165 10166 10167 10168 10169
    ##  [85] 10170 10171 10172 10173 10174 10175 10176 10177 10178 10179 10185 10197
    ##  [97] 10199 10213 10242 10249 10256 10259 10260 10261 10265 10268 10269 10270
    ## [109] 10271 10272 10273 10274 10275 10276 10277 10278 10279 10281 10285 10286
    ## [121] 10292 11001 11004 11005 11040 11096 11351 11352 11359 11362 11363 11371
    ## [133] 11380 11381 11386 11405 11411 11412 11413 11414 11416 11417 11419 11420
    ## [145] 11421 11422 11423 11424 11425 11427 11428 11429 11430 11431 11433 11436
    ## [157] 11439 11451 11499 11559 11580 11690 11694 11695 11697 10302 10307 10309
    ## [169] 10310 10311 10313

``` r
zori_compare
```

    ## # A tibble: 10 × 6
    ##    region_name county   neighborhood   `rent_2020-01-31` `rent_2021-01-31`  drop
    ##          <dbl> <chr>    <chr>                      <dbl>             <dbl> <dbl>
    ##  1       10007 New York Lower Manhatt…             6334.             5422. -913.
    ##  2       10069 New York <NA>                       4623.             3875. -748.
    ##  3       10009 New York Lower East Si…             3406.             2692. -714.
    ##  4       10016 New York Gramercy Park…             3731.             3019. -712.
    ##  5       10001 New York Chelsea and C…             4108.             3398. -710.
    ##  6       10002 New York Lower East Si…             3645.             2935. -710.
    ##  7       10004 New York Lower Manhatt…             3150.             2444. -706.
    ##  8       10038 New York Lower Manhatt…             3573.             2876. -698.
    ##  9       10012 New York Greenwich Vil…             3629.             2942. -686.
    ## 10       10010 New York Gramercy Park…             3697.             3012. -685.

A single tidy dataset was created by combining ZIP code–level
information with Zillow’s ZORI data from January 2015 to August 2024.
After cleaning and merging, the dataset contained 17284 observations,
representing 149 unique ZIP codes across 43 neighborhoods in New York
City. Several ZIP codes listed in the ZIP code dataset did not appear in
the Zillow rental dataset (e.g., 10464, 10474, 10475, 10499, 10550).
Many of these excluded ZIP codes correspond to special-purpose areas
such as commercial districts, large institutions, or PO boxes, which do
not have sufficient rental market activity to be represented in Zillow’s
database.

Rental prices shifted dramatically during the COVID-19 pandemic. When
comparing January 2020 to January 2021, the ten ZIP codes with the
largest price declines were identified. These were concentrated in
Manhattan, particularly in neighborhoods such as Lower Manhattan, the
East Village, Gramercy Park, Chelsea, and Greenwich Village.

The table below presents the ZIP codes with the steepest rental price
drops:

| region_name | county | neighborhood | rent_2020-01-31 | rent_2021-01-31 | drop |
|---:|:---|:---|---:|---:|---:|
| 10007 | New York | Lower Manhattan | 6334 | 5422 | -913 |
| 10069 | New York | NA | 4623 | 3875 | -748 |
| 10009 | New York | Lower East Side | 3406 | 2692 | -714 |
| 10016 | New York | Gramercy Park and Murray Hill | 3731 | 3019 | -712 |
| 10001 | New York | Chelsea and Clinton | 4108 | 3398 | -710 |
| 10002 | New York | Lower East Side | 3645 | 2935 | -710 |
| 10004 | New York | Lower Manhattan | 3150 | 2444 | -706 |
| 10038 | New York | Lower Manhattan | 3573 | 2876 | -698 |
| 10012 | New York | Greenwich Village and Soho | 3629 | 2942 | -686 |
| 10010 | New York | Gramercy Park and Murray Hill | 3697 | 3012 | -685 |

Overall, the analysis confirms that Manhattan’s core rental markets
experienced the most severe downturns during the pandemic, with typical
declines of 600–900 USD per month, while rental markets in the outer
boroughs were less severely affected.
